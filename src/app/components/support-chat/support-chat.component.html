<div class="ai-bot-container">
  <div class="ai-chat-panel" [class.active]="showChatPanel">
    <!-- Header -->
    <div class="ai-chat-header">
      <div class="header-content">
        <div class="chatbot-logo">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
            <rect x="2" y="2" width="20" height="16" rx="5" fill="#111" />
            <rect x="6" y="18" width="12" height="2.5" rx="1" fill="#111" />
          </svg>
        </div>
        <span class="header-title">{{ "AI_CHAT.TITLE" | translate }}</span>
      </div>
      <div class="header-actions">
        <button
          class="action-btn clear-btn"
          (click)="clearChat()"
          [title]="'AI_CHAT.CLEAR' | translate"
          [style.display]="showClearBtn ? '' : 'none'"
        >
          <svg
            width="16"
            height="16"
            fill="none"
            stroke="#fff"
            stroke-width="2"
            viewBox="0 0 24 24"
          >
            <path d="M3 6h18M9 6v12m6-12v12" />
          </svg>
        </button>
        <button
          class="action-btn close-btn"
          (click)="toggleChat()"
          [title]="'AI_CHAT.CLOSE' | translate"
        >
          <svg
            width="16"
            height="16"
            fill="none"
            stroke="#fff"
            stroke-width="2"
            viewBox="0 0 24 24"
          >
            <path d="M6 6l12 12M6 18L18 6" />
          </svg>
        </button>
      </div>
    </div>
    <!-- Body -->
    <div class="ai-chat-body" #chatBody>
      <div
        class="connection-status"
        [style.display]="!isConnected ? '' : 'none'"
      >
        <span>{{ "AI_CHAT.CONNECTION_LOST" | translate }}</span>
      </div>
      <!-- Chỉ show một message demo (hoặc lấy message mới nhất ở TS binding ra) -->
      <div class="chat-messages">
        <div
          [ngClass]="{
            'ai-message': true,
            bot: currentMsg?.from === 'bot',
            user: currentMsg?.from === 'user'
          }"
          class="message-wrapper"
        >
          <div class="message-bubble">
            <div class="message-content">{{ currentMsg?.text }}</div>
            <div class="message-time">
              {{ formatTime(currentMsg?.timestamp) }}
            </div>
          </div>
        </div>
      </div>
      <!-- Typing Indicator -->
      <div class="typing-indicator" [class.visible]="isTyping">
        <div class="ai-message bot">
          <div class="message-avatar">
            <svg viewBox="0 0 24 24" width="14" height="14" fill="#111">
              <circle cx="12" cy="12" r="3" />
              <path d="M12 1v6m0 6v6m11-7h-6m-6 0H1" />
            </svg>
          </div>
          <div class="typing-animation">
            <div class="typing-dots">
              <span></span><span></span><span></span>
            </div>
            <div class="typing-text">{{ "AI_CHAT.TYPING" | translate }}</div>
          </div>
        </div>
      </div>
      <!-- Quick replies, chỉ hiển thị 1 row demo, TS xử lý gán quickReplyText nếu cần -->
      <div
        class="quick-replies"
        [style.display]="showQuickReplies ? '' : 'none'"
      >
        <div class="quick-replies-title">
          {{ "AI_CHAT.QUICK_REPLIES_TITLE" | translate }}
        </div>
        <div class="quick-reply-buttons">
          <button
            class="quick-reply-btn"
            (click)="sendQuickReply(quickReplyText)"
          >
            {{ quickReplyText }}
          </button>
        </div>
      </div>
    </div>
    <!-- Input -->
    <div class="ai-chat-input">
      <div class="input-container" [class.disabled]="!isConnected">
        <textarea
          #messageInput
          [(ngModel)]="message"
          (keydown)="onKeyDown($event)"
          [placeholder]="'AI_CHAT.PLACEHOLDER' | translate"
          rows="1"
          [disabled]="!isConnected"
          class="message-textarea"
        ></textarea>
        <button
          class="send-btn"
          (click)="sendMessage()"
          [disabled]="!message.trim() || !isConnected || isTyping"
          [class.sending]="isTyping"
        >
          <svg
            *ngIf="!isTyping"
            viewBox="0 0 24 24"
            width="20"
            height="20"
            fill="#fff"
          >
            <path d="M2,21L23,12L2,3V10L17,12L2,14V21Z" />
          </svg>
          <div *ngIf="isTyping" class="loading-spinner">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="#111">
              <circle cx="12" cy="12" r="3" />
            </svg>
          </div>
        </button>
      </div>
      <div class="input-hint" [style.display]="isConnected ? '' : 'none'">
        {{ "AI_CHAT.INPUT_HINT" | translate }}
      </div>
    </div>
  </div>
  <!-- Bot Icon -->
  <div
    class="ai-bot-icon"
    (click)="toggleChat()"
    [class.active]="showChatPanel"
  >
    <div class="icon-inner">
      <svg
        *ngIf="!showChatPanel"
        width="30"
        height="30"
        viewBox="0 0 24 24"
        fill="none"
      >
        <rect x="2" y="2" width="20" height="16" rx="5" fill="#111" />
        <rect x="6" y="18" width="12" height="2.5" rx="1" fill="#111" />
      </svg>
      <svg
        *ngIf="showChatPanel"
        width="30"
        height="30"
        viewBox="0 0 24 24"
        fill="none"
      >
        <path d="M18 6L6 18M6 6l12 12" stroke="#111" stroke-width="2" />
      </svg>
    </div>
  </div>
</div>
